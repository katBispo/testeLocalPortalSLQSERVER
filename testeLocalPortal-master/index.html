<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restrições CCP</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="styleHome.css">
</head>

<body>

    <div class="header">
        <img src="vale-logo-1.svg" alt="Icone Vale">
        <span class="title">Restrições CCP</span>
    </div>

    <div class="ccp-container">
        <button>CCP-TFPM</button>
        <button>CCP-ACD</button>
        <button>CCP-TFCJ</button>
        <button>CCP-TFSP</button>
        <button>CCP-CG-SLS</button>
        <button>CMPN-EFC</button>
        <button>CCP-TERMINAIS</button>
        <button>CCP-OEM</button>
        <button>CCP-MBA</button>
        <button>CCP-PBA</button>
    </div>

    <div class="title">
        CCP ESCOLHIDO
    </div>

    <div class="filters">
        <div>
            <button onclick="abrirOverlayFiltro()">Filtrar</button>
            <button onclick="abrirOverlayExport()">Exportar</button>
        </div>
    </div>

    <div class="table-container">
        <table id="dados-tabela">
            <thead>
                <tr>
                    <th>Descrição da Restrição</th>
                    <th>Setor Pátio</th>
                    <th>Status da Restrição</th>
                    <th>Responsável</th>
                    <th>Data de cadastro</th>
                    <th>Previsão de Retirada</th>
                    <th>Última Mudança</th>
                    <th>Desativação</th>
                    <th>Número de dias ativos</th>
                    <th>Observação</th>
                    <th>Status de Conclusão</th>


                </tr>
            </thead>
            <tbody>

            </tbody>
        </table>
        <script src="script.js"></script>

    </div>

    <div class="overlay" id="filterOverlay">
        <div class="overlay-content">
            <h3>Filtrar por Colunas</h3>

            <!-- Filtro por Descrição -->
            <div>
                <label for="descricaoInput">Descrição da Restrição:</label>
                <input type="text" id="descricaoInput" onkeyup="filtrarTabela()" placeholder="Pesquisar descrição...">
            </div>

            <!-- Filtro por Setor -->
            <div>
                <label for="setorInput">Setor Pátio:</label>
                <input type="text" id="setorInput" onkeyup="filtrarTabela()" placeholder="Pesquisar setor...">
            </div>

            <!-- Filtro por Status -->
            <div>
                <label for="statusInput">Status da Restrição:</label>
                <input type="text" id="statusInput" onkeyup="filtrarTabela()" placeholder="Pesquisar status...">
            </div>

            <!-- Filtro por Responsável -->
            <div>
                <label for="responsavelInput">Responsável:</label>
                <input type="text" id="responsavelInput" onkeyup="filtrarTabela()"
                    placeholder="Pesquisar responsável...">
            </div>


             <!-- Filtro por Data de Cadastro -->
        <div>
            <label for="dataInicioInput">Data de Cadastro (Início):</label>
            <input type="date" id="dataInicioInput" onchange="filtrarTabela()">
        </div>
        <div>
            <label for="dataFimInput">Data de Cadastro (Fim):</label>
            <input type="date" id="dataFimInput" onchange="filtrarTabela()">
        </div>


            <button onclick="fecharOverlay()">Fechar</button>
            <button onclick="aplicarFiltro()">Aplicar</button>
        </div>
    </div>
    <div class="overlay" id="exportOverlay">
        <div class="overlay-content">
            <button onclick="exportarParaExcel()">Exportar para Excel</button>
            <button onclick="exportarParaCSV()">Exportar para CSV</button>
            <button onclick="fecharOverlay()">Fechar</button>
        </div>
    </div>

    <script>


        function abrirOverlayFiltro() {
            document.getElementById('filterOverlay').style.display = 'flex';
        }

        function fecharOverlay() {
            document.getElementById('filterOverlay').style.display = 'none';
            document.getElementById('exportOverlay').style.display = 'none';
        }

        function abrirOverlayExport() {
            document.getElementById('exportOverlay').style.display = 'flex';
        }

        function aplicarFiltro() {
            filtrarTabela(); // Chama a função para aplicar o filtro
        }


      function filtrarTabela() {
        var tabela = document.getElementById('dados-tabela');
        var descricaoFiltro = document.getElementById('descricaoInput').value.toLowerCase();
        var setorFiltro = document.getElementById('setorInput').value.toLowerCase();
        var statusFiltro = document.getElementById('statusInput').value.toLowerCase();
        var responsavelFiltro = document.getElementById('responsavelInput').value.toLowerCase();
        var dataInicioFiltro = document.getElementById('dataInicioInput').value;
        var dataFimFiltro = document.getElementById('dataFimInput').value;

        for (var i = 1; i < tabela.rows.length; i++) {
            var descricao = tabela.rows[i].cells[0].innerText.toLowerCase(); // Descrição da Restrição
            var setor = tabela.rows[i].cells[1].innerText.toLowerCase(); // Setor Pátio
            var status = tabela.rows[i].cells[2].innerText.toLowerCase(); // Status da Restrição
            var responsavel = tabela.rows[i].cells[3].innerText.toLowerCase(); // Responsável
            var dataCadastro = tabela.rows[i].cells[4].innerText; // Data de Cadastro

            // Convertendo a data de cadastro para um objeto Date
            var dataCadastroObj = new Date(dataCadastro);

            // Verifica se a linha deve ser exibida
            var deveExibir = (descricao.includes(descricaoFiltro) || descricaoFiltro === '') &&
                (setor.includes(setorFiltro) || setorFiltro === '') &&
                (status.includes(statusFiltro) || statusFiltro === '') &&
                (responsavel.includes(responsavelFiltro) || responsavelFiltro === '') &&
                (dataInicioFiltro === '' || dataCadastroObj >= new Date(dataInicioFiltro)) && // Verifica a data de início
                (dataFimFiltro === '' || dataCadastroObj <= new Date(dataFimFiltro)); // Verifica a data de fim

            // Log para verificar valores
            console.log(`Linha ${i}: ${descricao}, ${setor}, ${status}, ${responsavel}, ${dataCadastro} => Deve Exibir: ${deveExibir}`);

            tabela.rows[i].style.display = deveExibir ? '' : 'none';
        }
    }


        function exportarParaExcel() {
            var tabela = document.getElementById('dados-tabela');
            var wb = XLSX.utils.table_to_book(tabela, { sheet: "Sheet1" });
            XLSX.writeFile(wb, 'tabela.xlsx');
            fecharOverlay();
        }

        function exportarParaCSV() {
            var tabela = document.getElementById('dados-tabela');
            var csv = XLSX.utils.sheet_to_csv(XLSX.utils.table_to_sheet(tabela));
            var blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            var link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = 'tabela.csv';
            link.click();
            fecharOverlay();
        }
    </script>
</body>

</html>